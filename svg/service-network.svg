<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <style>
    .node {
      fill: #f0f5ff;
      stroke: #326ce5;
      stroke-width: 2;
    }
    .pod {
      fill: #d4e5ff;
      stroke: #326ce5;
      stroke-width: 1.5;
    }
    .container {
      fill: #b3d1ff;
      stroke: #326ce5;
      stroke-width: 1;
    }
    .service {
      fill: #ffe0b3;
      stroke: #ff9900;
      stroke-width: 1.5;
    }
    .endpoint {
      fill: #ffd699;
      stroke: #ff9900;
      stroke-width: 1;
    }
    .client {
      fill: #e6f2ff;
      stroke: #326ce5;
      stroke-width: 1.5;
    }
    .kube-proxy {
      fill: #d9f2d9;
      stroke: #47d147;
      stroke-width: 1.5;
    }
    .iptables {
      fill: #f2f2f2;
      stroke: #999;
      stroke-width: 1;
    }
    .arrow {
      fill: none;
      stroke: #666;
      stroke-width: 1.5;
      marker-end: url(#arrowhead);
    }
    .dashed-arrow {
      fill: none;
      stroke: #666;
      stroke-width: 1.5;
      stroke-dasharray: 5,3;
      marker-end: url(#arrowhead);
    }
    .packet {
      fill: #ff6666;
    }
    .label {
      font-family: 'Arial', sans-serif;
      font-size: 14px;
      text-anchor: middle;
    }
    .small-label {
      font-family: 'Arial', sans-serif;
      font-size: 12px;
      text-anchor: middle;
    }
    .title {
      font-family: 'Arial', sans-serif;
      font-size: 18px;
      font-weight: bold;
      text-anchor: middle;
    }
    .highlight {
      animation: pulse 1.5s infinite alternate;
    }
    @keyframes pulse {
      from { opacity: 1; }
      to { opacity: 0.6; }
    }
    .animate {
      animation: movePacket 3s ease-in-out;
    }
    @keyframes movePacket {
      0% { transform: translateX(0) translateY(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateX(300px) translateY(0); opacity: 0; }
    }
  </style>
  
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
    </marker>
  </defs>
  
  <rect width="100%" height="100%" fill="#f8f9fa" />
  
  <text x="400" y="40" class="title">Kubernetes Service 网络工作原理</text>
  
  <!-- 客户端 -->
  <rect x="100" y="100" width="120" height="60" rx="5" ry="5" class="client" id="client" />
  <text x="160" y="135" class="label">客户端</text>
  
  <!-- Service -->
  <rect x="340" y="100" width="120" height="60" rx="5" ry="5" class="service" id="service" />
  <text x="400" y="125" class="label">Service</text>
  <text x="400" y="145" class="small-label">ClusterIP: 10.96.1.10</text>
  
  <!-- 节点 1 -->
  <rect x="100" y="200" width="280" height="350" rx="5" ry="5" class="node" id="node1" />
  <text x="240" y="220" class="label">节点 1</text>
  
  <!-- 节点 1 上的 kube-proxy -->
  <rect x="120" y="240" width="240" height="50" rx="5" ry="5" class="kube-proxy" id="kube-proxy1" />
  <text x="240" y="270" class="label">kube-proxy</text>
  
  <!-- 节点 1 上的 iptables 规则 -->
  <rect x="120" y="300" width="240" height="100" rx="5" ry="5" class="iptables" id="iptables1" />
  <text x="240" y="320" class="label">iptables 规则</text>
  <text x="240" y="340" class="small-label">PREROUTING → KUBE-SERVICES</text>
  <text x="240" y="360" class="small-label">KUBE-SERVICES → KUBE-SVC-XXX</text>
  <text x="240" y="380" class="small-label">KUBE-SVC-XXX → KUBE-SEP-XXX</text>
  
  <!-- 节点 1 上的 Pod 1 -->
  <rect x="130" y="410" width="100" height="120" rx="5" ry="5" class="pod" id="pod1" />
  <text x="180" y="430" class="label">Pod 1</text>
  <text x="180" y="450" class="small-label">10.244.1.2:8080</text>
  <rect x="140" y="460" width="80" height="60" rx="3" ry="3" class="container" />
  <text x="180" y="490" class="small-label">应用容器</text>
  
  <!-- 节点 1 上的 Pod 2 -->
  <rect x="250" y="410" width="100" height="120" rx="5" ry="5" class="pod" id="pod2" />
  <text x="300" y="430" class="label">Pod 2</text>
  <text x="300" y="450" class="small-label">10.244.1.3:8080</text>
  <rect x="260" y="460" width="80" height="60" rx="3" ry="3" class="container" />
  <text x="300" y="490" class="small-label">应用容器</text>
  
  <!-- 节点 2 -->
  <rect x="420" y="200" width="280" height="350" rx="5" ry="5" class="node" id="node2" />
  <text x="560" y="220" class="label">节点 2</text>
  
  <!-- 节点 2 上的 kube-proxy -->
  <rect x="440" y="240" width="240" height="50" rx="5" ry="5" class="kube-proxy" id="kube-proxy2" />
  <text x="560" y="270" class="label">kube-proxy</text>
  
  <!-- 节点 2 上的 iptables 规则 -->
  <rect x="440" y="300" width="240" height="100" rx="5" ry="5" class="iptables" id="iptables2" />
  <text x="560" y="320" class="label">iptables 规则</text>
  <text x="560" y="340" class="small-label">PREROUTING → KUBE-SERVICES</text>
  <text x="560" y="360" class="small-label">KUBE-SERVICES → KUBE-SVC-XXX</text>
  <text x="560" y="380" class="small-label">KUBE-SVC-XXX → KUBE-SEP-XXX</text>
  
  <!-- 节点 2 上的 Pod 3 -->
  <rect x="450" y="410" width="100" height="120" rx="5" ry="5" class="pod" id="pod3" />
  <text x="500" y="430" class="label">Pod 3</text>
  <text x="500" y="450" class="small-label">10.244.2.2:8080</text>
  <rect x="460" y="460" width="80" height="60" rx="3" ry="3" class="container" />
  <text x="500" y="490" class="small-label">应用容器</text>
  
  <!-- 节点 2 上的 Pod 4 -->
  <rect x="570" y="410" width="100" height="120" rx="5" ry="5" class="pod" id="pod4" />
  <text x="620" y="430" class="label">Pod 4</text>
  <text x="620" y="450" class="small-label">10.244.2.3:8080</text>
  <rect x="580" y="460" width="80" height="60" rx="3" ry="3" class="container" />
  <text x="620" y="490" class="small-label">应用容器</text>
  
  <!-- Endpoints -->
  <rect x="580" y="100" width="120" height="60" rx="5" ry="5" class="endpoint" id="endpoints" />
  <text x="640" y="125" class="label">Endpoints</text>
  <text x="640" y="145" class="small-label">Pod IP列表</text>
  
  <!-- 连接线 -->
  <!-- 客户端到Service -->
  <path d="M 220 130 L 340 130" class="arrow" id="client-to-service" />
  
  <!-- Service到Endpoints -->
  <path d="M 460 130 L 580 130" class="dashed-arrow" id="service-to-endpoints" />
  
  <!-- kube-proxy到iptables -->
  <path d="M 240 290 L 240 300" class="arrow" id="kube-proxy1-to-iptables1" />
  <path d="M 560 290 L 560 300" class="arrow" id="kube-proxy2-to-iptables2" />
  
  <!-- kube-proxy到Endpoints -->
  <path d="M 240 240 C 240 80, 640 80, 640 100" class="dashed-arrow" id="kube-proxy1-to-endpoints" />
  <path d="M 560 240 C 560 80, 640 80, 640 100" class="dashed-arrow" id="kube-proxy2-to-endpoints" />
  
  <!-- Service到Pod的流量路径 -->
  <path d="M 400 160 C 400 200, 180 350, 180 410" class="arrow" id="service-to-pod1" />
  <path d="M 400 160 C 400 200, 300 350, 300 410" class="arrow" id="service-to-pod2" />
  <path d="M 400 160 C 400 200, 500 350, 500 410" class="arrow" id="service-to-pod3" />
  <path d="M 400 160 C 400 200, 620 350, 620 410" class="arrow" id="service-to-pod4" />
  
  <!-- 数据包 -->
  <circle cx="280" cy="130" r="5" fill="#ff6666" id="packet1" style="opacity: 0;" />
  <circle cx="400" cy="250" r="5" fill="#ff6666" id="packet2" style="opacity: 0;" />
  
  <!-- 图例 -->
  <rect x="100" y="560" width="15" height="15" class="service" />
  <text x="125" y="573" class="small-label" style="text-anchor: start;">Service</text>
  
  <rect x="200" y="560" width="15" height="15" class="endpoint" />
  <text x="225" y="573" class="small-label" style="text-anchor: start;">Endpoints</text>
  
  <rect x="300" y="560" width="15" height="15" class="pod" />
  <text x="325" y="573" class="small-label" style="text-anchor: start;">Pod</text>
  
  <rect x="400" y="560" width="15" height="15" class="kube-proxy" />
  <text x="425" y="573" class="small-label" style="text-anchor: start;">kube-proxy</text>
  
  <rect x="500" y="560" width="15" height="15" class="iptables" />
  <text x="525" y="573" class="small-label" style="text-anchor: start;">iptables规则</text>
  
  <line x1="600" y1="568" x2="630" y2="568" class="arrow" />
  <text x="655" y="573" class="small-label" style="text-anchor: start;">数据流向</text>
  
  <line x1="700" y1="568" x2="730" y2="568" class="dashed-arrow" />
  <text x="755" y="573" class="small-label" style="text-anchor: start;">控制流向</text>
</svg>
